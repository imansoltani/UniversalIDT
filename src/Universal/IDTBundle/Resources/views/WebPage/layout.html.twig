{% extends 'base.html.twig' %}

{% block title %}{% block subtitle '' %}Home :: Universal IDT{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <!-- FONT -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400italic,600italic,400,600" rel="stylesheet">
    <link href="{{ asset("bundles/universalidt/home/css/font-awesome.min.css") }}" rel="stylesheet">

    <!-- STYLESHEET -->
    <link href="{{ asset("bundles/universalidt/home/css/bootstrap.min.css") }}" rel="stylesheet">
    <link href="{{ asset("bundles/universalidt/home/css/dataTables.bootstrap.css") }}" rel="stylesheet">
    <link href="{{ asset("bundles/universalidt/home/css/owl.carousel.css") }}" rel="stylesheet">
    <link href="{{ asset("bundles/universalidt/home/css/owl.theme.css") }}" rel="stylesheet">
    <link href="{{ asset("bundles/universalidt/js/plugins/msgGrowl/css/msgGrowl.css") }}" rel="stylesheet">
    <link href="{{ asset("bundles/universalidt/css/ui-lightness/jquery-ui-1.10.0.custom.min.css") }}" rel="stylesheet">
    <link href="{{ asset("bundles/universalidt/css/base-admin-3.css") }}" rel="stylesheet">
    <link href="{{ asset("bundles/universalidt/css/base-admin-3-responsive.css") }}" rel="stylesheet">
    <link href="{{ asset("bundles/universalidt/home/css/jquery.fs.stepper.css") }}" rel="stylesheet">
    <link href="{{ asset("bundles/universalidt/home/css/style.css") }}" rel="stylesheet">
    <link href="{{ asset("bundles/universalidt/home/css/style-responsive.css") }}" rel="stylesheet">
    <!--[if lt IE 9]>
    <script type="text/javascript" src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script type="text/javascript" src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
{% endblock %}
{% block body_attr %}data-spy="scroll" data-target="#main-menu" id="top"{% endblock body_attr %}

{% block body %}
    <div class="header clearfix"><!-- START HEADER SECTION-->

        <div class="header-top clearfix"><!-- HEADER TOP -->
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <div class="header-top-menu clearfix">
                            <a href="#header-top-menu" data-toggle="collapse" class="header-top-menu-collapse"><i class="fa fa-gear"></i></a>
                            <div class="collapse" id="header-top-menu"><!-- HEADER TOP MENU -->
                                <ul>
                                    <li><a href="#basket" data-toggle="target"><i class="fa fa-shopping-cart"></i> Cart(<span id="cart_total_items">-</span>)</a></li>
                                    {% if is_granted("IS_AUTHENTICATED_REMEMBERED") %}
                                        <li class="dropdown">
                                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">{{ app.user.username }}<span class="caret"></span></a>
                                            <ul class="dropdown-menu dropdown-menu-right">
                                                <li><a href="{{ path('fos_user_profile_show') }}">Profile</a></li>
                                                <li><a href="{{ path('fos_user_security_logout') }}">{{ 'layout.logout'|trans({}, 'FOSUserBundle') }}</a></li>
                                            </ul>
                                        </li>
                                    {% else %}
                                        <li><a href="{{ path('fos_user_security_login') }}">{{ 'layout.login'|trans({}, 'FOSUserBundle') }}</a></li>
                                        <li><a href="{{ path('fos_user_registration_register') }}">{{ 'layout.register'|trans({}, 'FOSUserBundle') }}</a></li>
                                        <li class="dropdown">
                                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Language<span class="caret"></span></a>
                                            <ul class="dropdown-menu dropdown-menu-right">
                                                {% for name, iso in languages %}
                                                    <li><a href="{{ path('WebPage_main', {'_locale':iso}) }}">{{ name }}</a></li>
                                                {% endfor %}
                                            </ul>
                                        </li>
                                    {% endif %}
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="navbar navbar-inverse"><!-- HEADER BOTTOM -->
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-menu">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="#"><img src="{{ asset('bundles/universalidt/home/img/logo.png') }}" alt="Universal"></a><!-- LOGO -->
                </div>

                <div class="collapse navbar-collapse" id="main-menu"><!-- MAIN MENU -->
                    <ul class="nav navbar-nav navbar-right">
                        <li class="active"><a href="#top">Home</a></li>
                        <li><a href="#calling_cards">Calling Cards</a></li>
                        <li><a href="#rates">Rates</a></li>
                        <li><a href="#application">Applications</a></li>
                        <li><a href="#basket">Basket</a></li>
                        <li><a href="#contact">Contact</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div><!-- END HEADER SECTION -->

    <div class="main clearfix">

        {#{{ render(controller('UniversalIDTBundle:Home:sliderSection')) }}#}

        {{ render(controller('UniversalIDTBundle:WebPage:callingCards')) }}

        {{ render(controller('UniversalIDTBundle:WebPage:rates')) }}

        {#{{ render(controller('UniversalIDTBundle:Home:applicationSection')) }}#}

        {#{{ render(controller('UniversalIDTBundle:Home:downloadSection')) }}#}

        {{ render(controller('UniversalIDTBundle:WebPage:basket')) }}

        {#{{ render(controller('UniversalIDTBundle:Home:contactSection')) }}#}

    </div>

    <div class="extra clearfix"><!-- START FOOTER TOP SECTION -->
        <div class="container">
            {% include 'UniversalIDTBundle::extra.html.twig' %}
        </div>
    </div><!-- END FOOTER TOP SECTION -->

    <div class="footer clearfix"><!-- START FOOTER BOTTOM SECTION -->
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <div class="copyright clearfix">
                        <p>&copy; 2015 Universal. All Right Reserved</p>
                    </div>
                </div>
            </div>
        </div>
    </div><!-- END FOOTER BOTTOM SECTION -->



    <div class="modal fade" id="calling-card-modal"><!-- CALLING CARD MODAL -->
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">Calling Card</h4>
                </div>
                <div class="modal-body clearfix"></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
{% endblock body %}

{% block javascripts %}
    {{ parent() }}
    <!-- SET ALL SCRIPT AT BODY BOTTOM TO LOAD PAGE FAST -->
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
    <script type="text/javascript" src="{{ asset("bundles/universalidt/home/js/bootstrap.min.js") }}"></script>
    <script type="text/javascript" src="{{ asset("bundles/universalidt/home/js/bootstrap.waiting.js") }}"></script>
    <script type="text/javascript" src="{{ asset("bundles/universalidt/home/js/jquery.dataTables.min.js") }}"></script>
    <script type="text/javascript" src="{{ asset("bundles/universalidt/home/js/dataTables.bootstrap.min.js") }}"></script>
    <script type="text/javascript" src="{{ asset("bundles/universalidt/home/js/jquery.fs.stepper.js") }}"></script>
    <script type="text/javascript" src="{{ asset("bundles/universalidt/home/js/owl.carousel.min.js") }}"></script>
    <script type="text/javascript" src="{{ asset("bundles/universalidt/home/js/gmaps.js") }}"></script>
    <script type="text/javascript" src="{{ asset("bundles/universalidt/js/plugins/validate/jquery.validate.js") }}"></script>
    <script type="text/javascript" src="{{ asset("bundles/universalidt/js/plugins/msgGrowl/js/msgGrowl.js") }}"></script>
    <script type="text/javascript" src="{{ asset("bundles/universalidt/js/plugins/lightbox/jquery.lightbox.min.js") }}"></script>
    <script type="text/javascript" src="{{ asset("bundles/universalidt/js/Application.js") }}"></script>
    <script type="text/javascript" src="{{ asset("bundles/universalidt/home/js/scripts.js") }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/universalidt/js/jquery.cookie.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/universalidt/js/json2.js') }}"></script>
    <script type="text/javascript">
        var selected_products = [];

        var selected_products_currency = "";

        function cookieClear() {
            selected_products = [];
            $.cookie("products", "[]", { path: '/' });

            selected_products_currency = "";
            $.cookie("products_currency", "", { path: '/' });
        }

        function loadSelectedProducts() {
            var products_json = $.cookie("products");
            selected_products = products_json == undefined ? [] : JSON.parse(products_json);

            selected_products_currency = $.cookie("products_currency") == undefined ? "" : $.cookie("products_currency");

            var valid = true;
            var types = ["buy", "recharge"];
            for(var product in selected_products) {
                if(     selected_products[product]['id'] == undefined ||
                        selected_products[product]['name'] == undefined ||
                        selected_products[product]['image'] == undefined ||
                        selected_products[product]['count'] == undefined ||
                        selected_products[product]['denomination'] == undefined ||
                        types.indexOf(selected_products[product]['type']) == -1
                ){
                    valid = false;
                    break;
                }
            }

            if(!valid) {
                cookieClear();
                $.msgGrowl ({
                    type: "error",
                    title: "Cookie is invalid",
                    text: 'Basket cleared.'
                });
            }

//            console.log(selected_products);
        }

        function updateCounts() {
            var total_count = 0;
            for(var product in selected_products)
                total_count += parseInt(selected_products[product]['count']);

//            $("#cart_total_items").html(selected_products.length);//total_count == 0 ? 0 : selected_products.length);
            $("#cart_total_items").html(total_count);
        }

        function addToCookie(_id, _name, _image, _denomination, _count, _currency, _type) {
            if(selected_products_currency != "" && selected_products_currency != _currency) {
                $.msgGrowl ({
                    type: "warning",
                    title: "Currency Error",
                    text: ('You must select carts with same currency. this='+_currency+ ' basket='+selected_products_currency)
                });
                return;
            }
            else if(selected_products_currency == "") {
                selected_products_currency = _currency;
                $.cookie("products_currency", _currency, { path: '/' });
            }

//                alert('product:'+_product_id+' count:'+_count+' denomination:'+_denomination+' type:'+_type);
            var _exist = false;
            for(var product in selected_products) {
                if(     +selected_products[product]['id'] == +_id &&
                        +selected_products[product]['denomination'] == +_denomination &&
                        selected_products[product]['type'] == _type
                ){
                    selected_products[product]['count'] = +selected_products[product]['count'] + +_count;
                    _exist = true;
                    break;
                }
            }

            if(!_exist)
                selected_products.push({'id':+_id, 'name':_name, 'image':_image, 'denomination':+_denomination, 'count':+_count, 'type':_type});

//            console.log(selected_products);

            var new_products_json = JSON.stringify(selected_products);

            $.cookie("products", new_products_json, { path: '/' });
            $.msgGrowl ({
                type: "success",
                title: "Added to Cart",
                text: 'Item successfully added to your cart.'
            });
            updateCounts();
        }

        $(document).ready(function(){
            loadSelectedProducts();
            updateCounts();
        });
    </script>
{% endblock javascripts %}
